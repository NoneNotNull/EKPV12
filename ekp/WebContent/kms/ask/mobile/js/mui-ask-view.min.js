require({cache:{"kms/ask/mobile/js/view/item/AskAdditionItemMixin":function(){define(["dojo/_base/declare","dojox/mobile/_ItemBase","dojo/dom-construct","dojo/string","dojo/dom-class","dojo/touch","mui/util","dojo/request","mui/rtf/RtfResizeUtil","dojo/_base/lang"],function(e,j,b,h,i,d,f,c,g,a){var k=e("kms.ask.item.AskAdditionItemMixin",[j],{tag:"li",buildRendering:function(){this._templated=!!this.templateString;if(!this._templated){this.domNode=this.containerNode=this.srcNodeRef||b.create(this.tag,{className:"muiAskAdditionItem"});this.contentNode=b.create("div",{className:"muiAskAdditionListItem"},this.domNode)}this.inherited(arguments);if(!this._templated){this.buildInternalRender()}},buildInternalRender:function(){this.infoNode=b.create("div",{className:"muiAskInfo"},this.containerNode);this.contentNode=b.create("div",{className:"muiAskContent",innerHTML:this.docContent+'<span class="muiAskTime">'+this.fdTime+"</span>"},this.infoNode);var l=new g({channel:"ask",containerNode:this.contentNode});this.subscribe("/mui/list/onPull",a.hitch(l,l.destroy))},_setLabelAttr:function(l){if(l){this._set("label",l)}}});return k})},"kms/ask/mobile/js/view/AskAdditionItemListMixin":function(){define(["dojo/_base/declare","mui/list/_TemplateItemListMixin","kms/ask/mobile/js/view/item/AskAdditionItemMixin","dojo/query","dijit/registry"],function(c,d,b,e,a){return c("kms.ask.AskAdditionItemListMixin",[d],{itemRenderer:b,onComplete:function(f){this.inherited(arguments);if(f.length==0){e(".muiAskAddition").style("display","none")}}})})},"kms/ask/mobile/js/view/AskCloseButtonMixin":function(){define(["dojo/_base/declare","dojo/topic","dijit/registry","dojo/request","mui/util","dojo/string","mui/dialog/Confirm","dojo/_base/lang","mui/dialog/Tip"],function(d,e,a,c,f,g,h,b,i){return d("kms.ask.AskCloseButtonsMixin",null,{name:"docContent",_url:"/kms/ask/kms_ask_topic/kmsAskTopic.do?method=close&fdId=${fdId}",close:function(){var k=c.post(f.formatUrl(g.substitute(this._url,{fdId:this.fdId})),{});var j=this;k.response.then(function(l){if(l.status==200){location.reload()}else{i.fail({text:"操作失败"})}})},onClick:function(j){h("确定结束问题？",null,b.hitch(this,function(k,l){if(k){this.close()}}));this.inherited(arguments)}})})},"kms/ask/mobile/js/view/item/AskReplyItemMixin":function(){define(["dojo/_base/declare","dojox/mobile/_ItemBase","dojo/dom-construct","dojo/string","dojox/mobile/Tooltip","dojo/dom-class","dojo/touch","mui/util","kms/ask/mobile/js/view/AskEvaluationMixin","dojo/request","kms/ask/mobile/js/view/AskBeBestMixin","mui/rtf/RtfResizeUtil","dojo/_base/lang","kms/ask/mobile/js/view/AskAdditionMixin","mui/dialog/OperaTip"],function(g,m,d,j,k,l,f,h,c,e,o,i,b,n,a){var p=g("kms.ask.item.AskReplyItemMixin",[m,c,o,n],{tag:"li",buildRendering:function(){this._templated=!!this.templateString;if(!this._templated){this.domNode=this.containerNode=this.srcNodeRef||d.create(this.tag,{className:"muiPostItem"});this.contentNode=d.create("div",{className:"muiPostContent"},this.domNode)}this.canOperate=this.beOperate();this.inherited(arguments);if(!this._templated){this.buildInternalRender()}},beOperate:function(){var q=false;for(name in this){if(/^can[A-Z](.*)B$/.test(name)){q=q||this[name]=="true"}}return q},onBodyClick:function(q){var s=q.target,r=true;while(s){if(s==this.operationNode){r=false;break}s=s.parentNode}if(r){this.defer(function(){this.tooltip.hide();this.tooltip.destroy();this.show=false;this.disconnect(this.handle)},500)}},buildInternalRender:function(){this.infosNode=d.create("div",{className:"muiPostContentT"},this.contentNode);this.infoNode=d.create("div",{className:"muiPostHead"},this.infosNode);this.imageNode=d.create("div",{innerHTML:j.substitute('<img src="${d}">',{d:this.icon}),className:"muiPostIcon"},this.infoNode);this.creatNode=d.create("div",{className:"muiPostCreate"},this.infoNode);this.nameNode=d.create("div",{innerHTML:this.fdName,className:"muiPostCreator muiAuthor"},this.creatNode);this.timeNode=d.create("div",{innerHTML:'<span><i class="mui mui-time"></i>'+this.fdPostTime+"</span>",className:"muiPostCreated"},this.creatNode);this.bestIconNode=d.create("span",{className:"muiAskBestIcon"},this.infoNode);if(this.canOperate){this.operationNode=d.create("div",{className:"muiPostReplyOpt",innerHTML:'<div class="muiTopicReplyOperation"><span class="l"></span><span class="f"></span><i class="mui mui-more"></i></div>'},this.infoNode);this.connect(this.operationNode,"click","onOperationClick")}var q=d.create("div",{className:"muiPostContentC",innerHTML:'<div class="muiFieldRtf">'+this.label+"</div>"},this.contentNode);var r=new i({channel:"ask",containerNode:q});this.subscribe("/mui/list/onPull",b.hitch(r,r.destroy));this.additionNode=d.create("div",{className:"muiAskPostAddition",innerHTML:"<div></div>",id:"addition_"+this.fdId},this.contentNode);this.evaluatoinNode=d.create("div",{className:"muiTopicReplyEvaluation",id:"evaluation_"+this.fdId},this.contentNode);if(this.fdIsBest=="true"){d.create("img",{src:h.formatUrl("/kms/ask/mobile/css/images/best.png")},this.bestIconNode)}},_setLabelAttr:function(q){if(q){this._set("label",q)}},buildTooltip:function(){this.inherited(arguments)},onOperationClick:function(q){if(this.operaTip&&this.operaTip.isShow){return}this.operas=[];this.buildTooltip();this.operaTip=a.tip({refNode:this.operationNode,operas:this.operas});this.inherited(arguments)}});return p})},"kms/ask/mobile/js/view/AskReplyButtonMixin":function(){define(["dojo/_base/declare","mui/form/editor/EditorPopupMixin","dojo/topic","dijit/registry"],function(c,d,b,a){return c("kms.ask.AskReplyButtonsMixin",d,{name:"docContent",_url:"/kms/ask/kms_ask_post/kmsAskPost.do?method=save&fdTopicId=${fdId}",onClick:function(e){this.defer(function(){this.onEditorClick(e)},300);this.inherited(arguments)},afterHideMask:function(){this.inherited(arguments);location.reload()}})})},"kms/ask/mobile/js/view/AskReplyItemListMixin":function(){define(["dojo/_base/declare","mui/list/_TemplateItemListMixin","kms/ask/mobile/js/view/item/AskReplyItemMixin","dojo/request","mui/util","dojo/_base/array","dojo/_base/json","dojo/dom-construct","dojo/query","mui/rtf/RtfResizeUtil","dojo/_base/lang"],function(e,b,j,d,f,h,k,c,i,g,a){return e("kms.ask.AskReplyItemListMixin",[b],{itemRenderer:j,evalDataUrl:"/kms/ask/kms_ask_comment/kmsAskComment.do?method=listComment",additionDataUrl:"/kms/ask/kms_ask_addition/kmsAskAddition.do?method=listAddition",buildRendering:function(){this.inherited(arguments);this.subscribe("/mui/list/loaded","requestEval");this.subscribe("/mui/list/loaded","requestAddition")},requestEval:function(n,l){if(n!=this){return}if(!l){return}this.buildPostIds(l);var m=this;d.post(f.formatUrl(this.evalDataUrl),{data:{fdPostIds:this.fdPostIds}}).response.then(function(p){var o=k.fromJson(p.text);m.renderEvalList(o)})},buildPostIds:function(m){if(this.fdPostIds){return}this.fdPostIds="";var l=m.datas;h.forEach(l,function(o,n){if(o[0]&&o[0].value){var p=o[0].value;this.fdPostIds+=(n==0?p:";"+p)}},this)},requestAddition:function(n,l){if(n!=this){return}if(!l){return}this.buildPostIds(l);var m=this;d.post(f.formatUrl(this.additionDataUrl),{data:{fdIds:this.fdPostIds}}).response.then(function(p){var o=k.fromJson(p.text);m.renderAdditionList(o)})},renderAdditionList:function(l){if(l.length==0){i(".muiAskPostAddition").style("display","none");return}h.forEach(l,function(r,p){var n=r.fdPostId;var s=i("#addition_"+n)[0],m=i("div",s)[0];if(m.childNodes.length==0){c.create("span",{innerHTML:"补充回答："},s,"first")}var q=c.create("div",{innerHTML:'<div class="muiAskInfo"><div class="muiAskContent">'+r.docContent+'<span class="muiAskTime">'+r.fdTime+"</span></div></div>",className:"muiAskAdditionItem"},m,"last");var o=new g({channel:"ask",containerNode:q});this.subscribe("/mui/list/onPull",a.hitch(o,o.destroy))},this)},renderEvalList:function(l){h.forEach(l,function(q,o){var m=q.fdPostId;var p=c.create("div",{innerHTML:'<span class="muiAuthor">'+q.fdName+"：</span>"+q.docContent+'<i class="muiTopicReplyEvaTime">'+q.fdTime+"</i>",className:"muiTopicReplyEvaluationLi"},i("#evaluation_"+m)[0],"last");var n=new g({channel:"ask",containerNode:p});this.subscribe("/mui/list/onPull",a.hitch(n,n.destroy))},this)}})})},"kms/ask/mobile/js/view/AskAdditionMixin":function(){define(["dojo/_base/declare","dojo/dom-construct","dojo/dom-style","mui/form/Editor","dojo/string","dojo/query","dojo/request","mui/dialog/Tip","dojo/_base/array","mui/util","dojo/Deferred","dojo/_base/lang","dojo/when","dojo/topic","dijit/registry","mui/form/editor/EditorUtil"],function(e,c,i,j,h,n,d,p,k,g,m,b,l,f,a,o){return e("kms.ask.AskAdditionMixin",null,{additionUrl:"/kms/ask/kms_ask_addition/kmsAskAddition.do?method=save&fdKmsAskTopicId=${fdTopicId}&fdKmsAskPostId=${fdId}",canAdditionB:null,buildTooltip:function(){this.inherited(arguments);if(this.canAdditionB=="true"){var q=this;this.operas.push({icon:"mui-addInfo",text:"补充",func:function(){o.popup(q.additionUrl,{fdTopicId:q.fdTopicId,fdId:q.fdId,name:"docContent"},function(r){f.publish("/mui/list/onPull",a.byId("askPostList"))})}})}}})})},"kms/ask/mobile/js/view/AskEvaluationMixin":function(){define(["dojo/_base/declare","dojo/dom-construct","dojo/dom-style","mui/form/Editor","dojo/string","dojo/query","dojo/request","mui/dialog/Tip","dojo/_base/array","mui/util","dojo/Deferred","dojo/_base/lang","dojo/when","dojo/topic","dijit/registry","mui/form/editor/EditorUtil"],function(e,c,i,j,h,n,d,p,k,g,m,b,l,f,a,o){return e("kms.ask.AskEvaluationMixin",null,{evaluationUrl:"/kms/ask/kms_ask_comment/kmsAskComment.do?method=save&fdPostId=${fdId}",canEvalB:null,buildTooltip:function(){this.inherited(arguments);if(this.canEvalB=="true"){var q=this;this.operas.push({icon:"mui-evaluation",text:"点评",func:function(){o.popup(q.evaluationUrl,{fdId:q.fdId,name:"docContent"},function(r){f.publish("/mui/list/onPull",a.byId("askPostList"))})}})}}})})},"kms/ask/mobile/js/view/AskBeBestMixin":function(){define(["dojo/_base/declare","mui/dialog/Confirm","dojo/request","mui/util","dojo/_base/lang","dojo/string","dijit/registry","dojo/topic","dojo/dom-construct"],function(e,i,d,g,b,h,a,f,c){return e("kms.ask.AskBeBestMixin",null,{canSetBestB:null,bestUrl:"/kms/ask/kms_ask_post/kmsAskPost.do?method=best&fdPostId=${fdId}&fdTopicId=${fdTopicId}",buildTooltip:function(){this.inherited(arguments);if(this.canSetBestB=="true"){var j=this;this.operas.push({icon:"mui-checked",text:"采纳",func:function(){j.onBeBest()}})}},best:function(){var k=d.post(g.formatUrl(h.substitute(this.bestUrl,{fdId:this.fdId,fdTopicId:this.fdTopicId})),{});var j=this;k.response.then(function(l){if(l.status==200){location.reload()}else{tip.fail({text:"操作失败"})}})},onBeBest:function(j){i("确定置为最佳？",null,b.hitch(this,function(k,l){if(k){this.best()}}))}})})}}});